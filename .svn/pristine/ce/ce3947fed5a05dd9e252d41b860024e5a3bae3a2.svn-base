<?php
class Pagos extends CI_Controller
{
	public $char_error_open;
	public $char_error_close;
	public $session_data;
	public $success;
    public $error_msg;
	function __construct()
	{
		parent::__construct();
		$this->load->model('rides','',TRUE);
		//$this->load->model('payments','',TRUE);
		$this->char_error_open = '<span class="btn btn-danger btn-xs" style="margin:3px;"> <button type="button" class="close" data-dismiss="alert" aria-hidden="true"> &nbsp;×</button>';
		$this->char_error_close = '</span>';
        $this->success = '';
        $this->error_msg = '';
        $this->name_img = '';
		if($this->session->userdata('logged_in'))
		{	
			$this->session_data = $this->session->userdata('logged_in');
		}
		else
		{
			redirect('login','refresh');
		}
	}
	
	public function listado_pagos(){


			$data['pagos']  = $this->rides->catalogo_traslados('pagos');
			if(($data['pagos']) === FALSE){
				$this->error_msg = '<div class="alert  text-danger">No hay traslados agendados en el sistema. agendo uno nuevo <a class="btn btn-green" href="'.base_url().'nuevo_traslado.html">Aquí</a></div>';
			}
			$data['nombre'] = $this->session_data['nombre'];
			$data['apellido'] = $this->session_data['apellido'];
			$data['usuario_i'] = $this->session_data['usuario_i'];
			$data['imagen_perfil'] = $this->session_data['imagen_perfil'];
			$data['success'] = $this->success;
			$data['error'] = $this->error_msg;
            $data['titulo'] = 'Gestion de Pagos';
			$data['content']  = 'gestion_de_pagos';
			$this->load->view('main_template',$data);
	}
	public function informacion_cliente(){
		if($this->input->is_ajax_request() && $this->input->post('cliente')){
			$result = $this->customers->get_cliente();
			if($result === FALSE){
				$data = array('status'=> FALSE,'msg'=>'<div class="alert alert-danger">No se encontraron resultados para mostrar</div>');
				echo json_encode($data);
			}else{
				
				$this->session->set_userdata('rfc_cliente',strtoupper($this->input->post('cliente')));
				$this->session->set_userdata('email_cliente',$result->txt_email);
				$data = array('status'=>TRUE,'cliente'=>$result);
				echo json_encode($data);
			}
		}
		else{
			show_404();
		}
		
	}
	public function update_status(){
		if($this->input->is_ajax_request() && $this->input->post('ride') && $this->input->post('stat')){
			$result = $this->rides->status_traslado();
			$data= array('status'=>$result['status'],'msg'=>$result['msg']);
			echo json_encode($data);
		}
		else{
			show_404();
		}
	}
	
}
