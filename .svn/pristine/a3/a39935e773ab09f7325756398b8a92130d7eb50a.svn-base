var rides = {
	data: Array(),
	pos:0,
	id_chk:'',
	id_traslado:'',
	cerrar:false,
	url:'',
	load_info:function(id){
		this.id_chk = id;
		this.pos = $('#txt_cliente').prop('selectedIndex');
		
		if($('#'+this.id_chk).is(':checked') === true){

			$.each(rides.data[rides.pos], function(index, val) {
				$('#'+index).val(val);
			});	
		}else{
			$.each(rides.data[rides.pos], function(index, val) {
		 		$('#'+index).val('');
			});
		}
		
	},
	update_ride:function(id,status){
		id_tmp = id.split('_');
 		$.ajax({
 			url:this.url+'estatus_traslado.html',
 			type:'POST',
 			dataType:'json',
 			data: {'ride':id_tmp[1],'stat':status},
 			success:function(data){
 				(data.status)?function(){
 					$.bootstrapGrowl(
 					data.msg,
	 					{
	 						type:'success',	
	 						align:'center',
	 						width:'auto',
	 						delay:2000,
	 						allow_dismiss:false
	 					}
 					);
 					if(!status){

						$('#'+id).parent().parent().removeClass('success');
						$('#estado_t_'+id_tmp[1]).text('PENDIENTE');
						//$('chk_'+id_tmp[1]);
					}
					else
					{
						$('#'+id).parent().parent().addClass('success');
						$('#estado_t_'+id_tmp[1]).text('REALIZADO');
						$('#chk_'+id_tmp[1]).attr('disabled','disabled');
						rides.cerrar=true;
					}
 				}()
 				:function(){
						$.bootstrapGrowl(
 					data.msg,
	 					{
	 						type:'error',	
	 						align:'center',
	 						width:'auto',
	 						delay:2000,
	 						allow_dismiss:false
	 					}
 					);
 				}();
 			},
 			error:function(){
 				$.bootstrapGrowl(
 					"Parece que su conexi칩n a internet no va bien!!!",
	 					{
	 						type:'danger',	
	 						align:'center',
	 						width:'auto',
	 						delay:3000,
	 						allow_dismiss:false
	 					}
 					);
 			}
 		});
 	},
 	payments:function(id){
 		id_tmp = id.split('_');
 		$.ajax({
 			url:this.url+'pago_traslado.html',
 			type:'POST',
 			dataType:'json',
 			data: {'payment':id_tmp[1]},
 			success:function(data){

 				(data.status)?function(){
 				$('#fecha_pago_'+id_tmp[1]).html(data.fecha);
 				$('#field_payment_'+id_tmp[1]).addClass('text-success').html('Realizado <span class="fa fa-check"></span>');
 					$.bootstrapGrowl(
 					data.msg,
	 					{
	 						type:'success',	
	 						align:'center',
	 						width:'auto',
	 						delay:2000,
	 						allow_dismiss:false
	 					}
 					);
 				}()
 				:function(){
						$.bootstrapGrowl(
 					data.msg,
	 					{
	 						type:'error',	
	 						align:'center',
	 						width:'auto',
	 						delay:2000,
	 						allow_dismiss:false
	 					}
 					);
 				}();

 				


 			},
 			error:function(){
 				$.bootstrapGrowl(
 					"Parece que su conexi칩n a internet no va bien!!!",
	 					{
	 						type:'danger',	
	 						align:'center',
	 						width:'auto',
	 						delay:3000,
	 						allow_dismiss:false
	 					}
 					);
 			}
 		});
 	},
 	modal:function(id,checked){
 			id_tmp = id.split('_');
 			this.id_traslado = id_tmp[1];
 			$('#myTraslado').val(this.id_traslado);
			$('#modal_servicio').modal({ 
	            backdrop:'static',
	            keyboard:true 
				}).on('shown.bs.modal',function(e){
					rides.cerrar = false;
              	}).on('hidden.bs.modal',function(){
					$('#myform_info_servicio [input]').val('');
					if(rides.cerrar == false){
						$('#chk_'+rides.id_traslado).attr('checked',!checked);
					}
						
				});
			
 	
 	},
	init_components:function(){
 		
       $('#table_traslados :checkbox').click(function(e){
        	rides.modal($(this).attr('id'),$(this).is(':checked'));
        	//rides.update_ride($(this).attr('id'),$(this).is(':checked'));
        });
        
        $('#table_traslados a').click(function(e){
        		e.preventDefault();
        		rides.payments($(this).attr('id'));
    			//abrir modal;
        });
       $('#myform_info_servicio').submit(function(e){
			e.preventDefault();
			$.ajax({
				url:$(this).attr('action'),
				type:'POST',
				dataType:'json',
				data:$(this).serialize(),
				success:function(data){
					(!data.status)?function(){
						$('#contError').html(data.msg);
					}
					():function(){
						$('#contError').empty().html(data.msg);
						rides.update_ride('chk_'+rides.id_traslado,'true');
					}();
				},
				error:function(){
					$('#contError').html('Parece que su conexi칩n a internet no va bien, intentelo m치s tarde.');
				}
			});
 		});
 	},
};
$(document).ready(function() {
	rides.init_components();
});